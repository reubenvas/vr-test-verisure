/**
 * Adds development addons to app
 * - Initializes Env Vars.
 * - Adds WebpackDevMiddleWare to compile client side React code
 * @typedef {{app: Express.Application}}
 * @param {Express.Application} app - generated by the function express()
 */
export default async (app) => {
    /*     eslint-disable global-require */
    const webpack = require('webpack');
    const webpackDevMiddleware = require('webpack-dev-middleware');
    const webpackHotMiddleware = require('webpack-hot-middleware');
    const config = require('../../../webpack.config.dev.babel');
    /*     eslint-enable global-require */

    // const webpack = (await import('webpack')).default;
    // const webpackDevMiddleWare = (await import('webpack-dev-middleware')).default;
    // const config = (await import('../../../webpack.config.dev.babel')).default;

    const compiler = webpack(config);
    const hotMiddleware = webpackHotMiddleware(compiler);

    app.use(webpackDevMiddleware(compiler, {
        publicPath: config.output.publicPath,
    }));
    app.use(hotMiddleware);
};
